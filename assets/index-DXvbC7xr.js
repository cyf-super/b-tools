import{j as e,r as n,A as j}from"./index-wNB2gzAK.js";import{g as ge,B as A,a as xe,d as _}from"./index-7eENfR5h.js";import{C}from"./utils-EZ6xXSrB.js";import{S as Z}from"./index-1ko0mtv0.js";import{a as fe,b as je,g as $}from"./utils-wNT_6sCc.js";import{f as we}from"./utils-QMY9RplF.js";import{m as ee,A as ve}from"./index-5BTxMJpH.js";const Ne="index-module_box_699e6",Se="index-module_select_7801d",ye="index-module_modal_cfaa5",be="index-module_content_6fba2",ke="index-module_icon_6ef84",Ae="index-module_left_8b4b3",Ce="index-module_loading_831c4",Ie="index-module_spinner-c7wet2_3a953",Be="index-module_size_60a86",g={box:Ne,select:Se,modal:ye,content:be,icon:ke,left:Ae,loading:Ce,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:Ie,size:Be},Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function Te({open:l,src:d,setOpen:i,footer:a,children:S}){const I=w=>{w.stopPropagation(),i(!1)};return e.jsx("div",{className:g.modal,onClick:I,style:l?{}:{display:"none"},children:e.jsxs("main",{className:g.content,onClick:w=>{w.stopPropagation()},children:[e.jsx("span",{className:g.icon,onClick:()=>i(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:g.left,children:d?e.jsx("img",{src:d,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:g.loading})}),S]}),a]})})}const Ee=[325,375,425,450,475,525,575,625,675,725,750,775],se=Ee.map(l=>({value:l,label:`宽度: ${l}px`})),te=25;let m={};function Qe(){const{files:l,setFiles:d}=ge(),[i,a]=n.useState([]),[S,I]=n.useState([]),[w,ae]=n.useState([]),[B,ie]=n.useState(["文件夹"]),[c,L]=n.useState(["mp4","文件夹"]),[v,T]=n.useState([]),[y,b]=n.useState(!1),[x,N]=n.useState(""),[E,R]=n.useState(""),[u,Q]=n.useState({name:"",num:2}),[k,D]=n.useState(!1),[r,J]=n.useState(450),[G,P]=n.useState(!0),[Y,le]=n.useState(!1),[z,ce]=n.useState(!0),V=n.useRef(!1),F=n.useRef(null);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!i.length)return;V.current?D(!1):K()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=r+c.join("");m[s]?N(m[s]):(N(""),k&&W()),V.current=k},[r,k]),n.useEffect(()=>{l.length&&M(l)},[l,Y]),n.useEffect(()=>{const s=r+c.join("");m[s]&&N(m[s])},[v]),n.useEffect(()=>{if(c.length){let s=i.filter(t=>c.includes(t.suffix));c.includes("文件夹")&&(s=[...S,...s]),s.sort(),T(s)}else T(i);N("")},[i,S,c]);const oe=s=>{const t=s.target.files;d([]),t&&(d([...t]),s.target.value="",j.success("上传成功"),X())};function M(s){const t=fe(s,{isThirtDir:Y});a(t.nameList),ie(["文件夹",...t.typeList]),I(t.dirList),R(t.dirName),L(["文件夹",...t.typeList]),ae(je(s))}const re=s=>{const t=[...v];t.splice(s,1),T(t)},de=s=>{if(!c.length){L([s]);return}const t=[...c],h=c.findIndex(o=>o===s);h>-1?t.splice(h,1):t.push(s),t.sort(),L(t)},q=async()=>{if(b(!0),G&&v.length>te){const s=Math.ceil(v.length/te);try{const t=await $({width:r,isSingle:s===1}),h=await me(t,s);for(let o=0;o<h.length;o++)await _(h[o],"详情.jpg");j.success("下载完成")}catch{j.error("下载失败!")}finally{b(!1)}}else if(x)console.log("dataUrl ",x),_(x,"详情.png"),j("下载成功"),b(!1);else{const s=await W();_(s,"详情.png"),j("下载成功"),b(!1)}},me=async(s,t)=>new Promise(h=>{const o=new Image;o.src=s;const O=[];o.onload=()=>{const p=F.current;if(!p)return;const f=p.getContext("2d"),{width:ue,height:he}=o,H=he/t;for(let U=0;U<t;U++){f==null||f.clearRect(0,0,p.width,p.height),p.width=ue,p.height=H,f==null||f.drawImage(o,0,-U*H);const pe=p.toDataURL();O.push(pe),O.length===t&&h(O)}}}),K=()=>{D(!0)},W=async()=>{try{const s=r+c.join("");if(m[s])return m[s];const t=await $({width:r,isSingle:!0});return N(t),m[s]=t,t}catch{j.error("加载失败")}},X=()=>{M(l),m={}};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:g.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:oe}),e.jsx("img",{src:Le,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",style:{width:r+"px"},children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(A,{className:"preview",disabled:i.length===0||y,onClick:X,children:"Reset"}),e.jsx(A,{className:"preview",disabled:i.length===0||y,onClick:K,children:"Preview"}),e.jsx(A,{className:"download",disabled:i.length===0||y,primary:!0,onClick:q,children:y?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",i.length]}),e.jsxs("span",{className:"typeNum",title:B.join(","),children:["文件种类：",B.length-1]})]}),e.jsx("div",{className:"options",children:B.map(s=>e.jsx("span",{className:c.includes(s)?"select":"",onClick:()=>de(s),children:s},s))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:E,onChange:s=>R(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:u.name,onChange:s=>Q({...u,name:s.target.value})}),e.jsx("input",{type:"text",placeholder:"数量",value:u.num,onChange:s=>Q({...u,num:+s.target.value})})]})]}),e.jsx(ee.div,{layout:!0,layoutId:"list",className:"list-container",id:"list",children:e.jsxs(ve,{children:[u.name&&e.jsx("div",{className:"watermarkList",children:Array.from({length:+u.num}).map((s,t)=>e.jsx("p",{className:"watermark",children:u.name||"长安不止三万里"},t))}),E&&e.jsx("p",{className:"imgTitle",children:E}),z?e.jsx(ne,{treeDirList:w,typeList:c}):v.map((s,t)=>e.jsxs(ee.li,{initial:{y:-200,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0},className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{src:s.image,alt:""}),s.name]}),e.jsx("div",{className:"delIcon",onClick:()=>re(t)})]},s.name))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(C,{checked:z,onChange:ce,label:"文件夹层级格式"}),e.jsx(C,{checked:G,onChange:P,label:"分割图片"}),e.jsx(C,{checked:Y,onChange:le,label:"只针对二级目录"}),e.jsx(Z,{value:r,onSelect:J,OPTIONS:se,label:"图片宽度： "})]})]}),e.jsx("canvas",{ref:F,style:{display:"none"}})]}),e.jsx(Te,{open:k,setOpen:D,src:x,footer:e.jsx(A,{primary:!0,onClick:()=>{q()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(C,{checked:G,onChange:P,label:"分割图片"}),e.jsx(Z,{value:r,onSelect:J,OPTIONS:se}),e.jsxs("div",{className:g.size,children:["大小: ",x&&we(xe(x))]})]})})]})}function ne({treeDirList:l,typeList:d,index:i=0}){return e.jsx("div",{className:"treeDirBox",style:{marginLeft:i*10+"px"},children:l==null?void 0:l.filter(a=>!!a&&(a.dir||d.includes(a.suffix))).map(a=>e.jsxs("div",{className:"item dirItem",children:[e.jsxs("div",{className:["fileName",a.dir?"dirIcon":""].join(" "),children:[e.jsx("img",{src:a.image,alt:""}),a.name||a.dir]}),e.jsx(ne,{treeDirList:a.list,typeList:d,index:i+1})]},a.name||a.dir))})}export{Qe as default};
