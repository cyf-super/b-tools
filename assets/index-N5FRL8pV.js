import{j as e,r as n,A as g}from"./index--0XXnGui.js";import{g as de,B as b,a as me,d as Y}from"./index-6t32YOx3.js";import{C as O}from"./utils-1FQzGlx1.js";import{S as K}from"./index-uidAMAqM.js";import{a as he,g as W}from"./utils-AvnRXQdO.js";import{f as ue}from"./utils-QMY9RplF.js";import{m as X,A as pe}from"./index-wuSjzDx6.js";const ge="index-module_box_699e6",fe="index-module_select_7801d",xe="index-module_modal_cfaa5",je="index-module_content_6fba2",we="index-module_icon_6ef84",ve="index-module_left_8b4b3",Se="index-module_loading_831c4",Ne="index-module_spinner-c7wet2_3a953",ye="index-module_size_60a86",u={box:ge,select:fe,modal:xe,content:je,icon:we,left:ve,loading:Se,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:Ne,size:ye},be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function ke({open:c,src:f,setOpen:i,footer:k,children:v}){const A=d=>{d.stopPropagation(),i(!1)};return e.jsx("div",{className:u.modal,onClick:A,style:c?{}:{display:"none"},children:e.jsxs("main",{className:u.content,onClick:d=>{d.stopPropagation()},children:[e.jsx("span",{className:u.icon,onClick:()=>i(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:u.left,children:f?e.jsx("img",{src:f,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:u.loading})}),v]}),k]})})}const Ae=[325,375,425,450,475,525,575,625,675],H=Ae.map(c=>({value:c,label:`宽度: ${c}px`})),Z=25;let r={};function Ge(){const{files:c,setFiles:f}=de(),[i,k]=n.useState([]),[v,A]=n.useState([]),[d,$]=n.useState(["文件夹"]),[a,R]=n.useState(["mp4","文件夹"]),[x,C]=n.useState([]),[S,N]=n.useState(!1),[j,w]=n.useState(""),[I,_]=n.useState(""),[B,ee]=n.useState(""),[y,L]=n.useState(!1),[l,Q]=n.useState(450),[E,J]=n.useState(!0),[T,se]=n.useState(!1),P=n.useRef(!1),U=n.useRef(null);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!i.length)return;P.current?L(!1):M()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=l+a.join("");r[s]?w(r[s]):(w(""),y&&q()),P.current=y},[l,y]),n.useEffect(()=>{c.length&&z(c)},[c,T]),n.useEffect(()=>{const s=l+a.join("");r[s]&&w(r[s])},[x]),n.useEffect(()=>{if(a.length){let s=i.filter(t=>a.includes(t.suffix));a.includes("文件夹")&&(s=[...v,...s]),s.sort(),C(s)}else C(i);w("")},[i,v,a]);const te=s=>{const t=s.target.files;f([]),t&&(f([...t]),s.target.value="",g.success("上传成功"))};function z(s){const t=he(s,{isThirtDir:T});k(t.nameList),$(["文件夹",...t.typeList]),A(t.dirList),_(t.dirName)}const ne=s=>{const t=[...x];t.splice(s,1),C(t)},ae=s=>{if(!a.length){R([s]);return}const t=[...a],m=a.findIndex(o=>o===s);m>-1?t.splice(m,1):t.push(s),t.sort(),R(t)},V=async()=>{if(N(!0),E&&x.length>Z){const s=Math.ceil(x.length/Z);try{const t=await W({width:l,isSingle:s===1}),m=await ie(t,s);for(let o=0;o<m.length;o++)await Y(m[o],"详情.jpg");g.success("下载完成")}catch{g.error("下载失败!")}finally{N(!1)}}else if(j)Y(j,"详情.png"),g("下载成功"),N(!1);else{await q();const s=l+a.join("");Y(r[s],"详情.png"),g("下载成功"),N(!1)}},ie=async(s,t)=>new Promise(m=>{const o=new Image;o.src=s;const D=[];o.onload=()=>{const h=U.current;if(!h)return;const p=h.getContext("2d"),{width:oe,height:ce}=o,F=ce/t;for(let G=0;G<t;G++){p==null||p.clearRect(0,0,h.width,h.height),h.width=oe,h.height=F,p==null||p.drawImage(o,0,-G*F);const re=h.toDataURL();D.push(re),D.length===t&&m(D)}}}),M=()=>{L(!0)},q=async()=>{try{const s=l+a.join("");r[s]||W({width:l,isSingle:!0}).then(t=>{w(t),r[s]=t}).catch(t=>{console.log("加载失败 ",t)})}catch{g.error("加载失败")}},le=()=>{z(c),r={}};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:u.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:te}),e.jsx("img",{src:be,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",style:{width:l+"px"},children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(b,{className:"preview",disabled:i.length===0||S,onClick:le,children:"Reset"}),e.jsx(b,{className:"preview",disabled:i.length===0||S,onClick:M,children:"Preview"}),e.jsx(b,{className:"download",disabled:i.length===0||S,primary:!0,onClick:V,children:S?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",i.length]}),e.jsxs("span",{className:"typeNum",title:d.join(","),children:["文件种类：",d.length-1]})]}),e.jsx("div",{className:"options",children:d.map(s=>e.jsx("span",{className:a.includes(s)?"select":"",onClick:()=>ae(s),children:s}))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:I,onChange:s=>_(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:B,onChange:s=>ee(s.target.value)})]})]}),e.jsx(X.div,{layout:!0,layoutId:"list",className:"list-container",id:"list",children:e.jsxs(pe,{children:[I&&e.jsx("p",{className:"imgTitle",children:I}),B&&e.jsx("p",{className:"watermark",children:B||"长安不止三万里"}),x.map((s,t)=>e.jsxs(X.li,{initial:{y:-200,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0},className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{src:s.image,alt:""}),s.name]}),e.jsx("div",{className:"delIcon",onClick:()=>ne(t)})]},s.name))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(O,{checked:E,onChange:J,label:"分割图片"}),e.jsx(O,{checked:T,onChange:se,label:"只针对二级目录"}),e.jsx(K,{value:l,onSelect:Q,OPTIONS:H,label:"图片宽度： "})]})]}),e.jsx("canvas",{ref:U,style:{display:"none"}})]}),e.jsx(ke,{open:y,setOpen:L,src:j,footer:e.jsx(b,{primary:!0,onClick:()=>{V()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(O,{checked:E,onChange:J,label:"分割图片"}),e.jsx(K,{value:l,onSelect:Q,OPTIONS:H}),e.jsxs("div",{className:u.size,children:["大小: ",j&&ue(me(j))]})]})})]})}export{Ge as default};
