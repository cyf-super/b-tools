import{j as e,r as n,A as f}from"./index-quEcoSPW.js";import{g as he,B as b,a as ue,d as O}from"./index-waVwfHD8.js";import{C as z}from"./utils-J5srvcb_.js";import{S as K}from"./index-aH0HOfmx.js";import{g as pe,a as ge,b as X}from"./utils-q-64YLiP.js";import{f as fe}from"./utils-QMY9RplF.js";import{m as H,A as xe}from"./index-DxXySgZM.js";const je="index-module_box_699e6",Se="index-module_select_7801d",we="index-module_modal_cfaa5",ve="index-module_content_6fba2",Ne="index-module_icon_6ef84",ye="index-module_left_8b4b3",Ae="index-module_loading_831c4",be="index-module_spinner-c7wet2_3a953",ke="index-module_size_60a86",u={box:je,select:Se,modal:we,content:ve,icon:Ne,left:ye,loading:Ae,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:be,size:ke},Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function Ie({open:o,src:x,setOpen:c,footer:k,children:v}){const C=d=>{d.stopPropagation(),c(!1)};return e.jsx("div",{className:u.modal,onClick:C,style:o?{}:{display:"none"},children:e.jsxs("main",{className:u.content,onClick:d=>{d.stopPropagation()},children:[e.jsx("span",{className:u.icon,onClick:()=>c(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:u.left,children:x?e.jsx("img",{src:x,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:u.loading})}),v]}),k]})})}const Le=[325,375,425,450,475,525,575,625,675],W=Le.map(o=>({value:o,label:`宽度: ${o}px`})),w=25,h={};function ze(){const{files:o,setFiles:x}=he(),[c,k]=n.useState([]),[v,C]=n.useState([]),[d,Z]=n.useState(["文件夹"]),[l,R]=n.useState(["mp4","文件夹"]),[p,I]=n.useState([]),[$,ee]=n.useState([]),[N,y]=n.useState(!1),[j,S]=n.useState(""),[L,se]=n.useState(""),[B,te]=n.useState(""),[A,E]=n.useState(!1),[r,_]=n.useState(450),[T,Q]=n.useState(!0),[D,ne]=n.useState(!1),J=n.useRef(!1),P=n.useRef(null);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!c.length)return;J.current?E(!1):V()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=r+l.join("");h[s]?S(h[s]):(S(""),A&&q()),J.current=A},[r,A]),n.useEffect(()=>{o.length&&U(o)},[o,D]),n.useEffect(()=>{const t=pe(Math.ceil(p.length/w)).map(i=>p.slice(i*w,(i+1)*w));ee(t);const a=r+l.join("");h[a]&&S(h[a])},[p]),n.useEffect(()=>{if(l.length){let s=c.filter(t=>l.includes(t.suffix));l.includes("文件夹")&&(s=[...v,...s]),s.sort(),I(s)}else I(c);S("")},[c,v,l]);const ie=s=>{const t=s.target.files;x([]),t&&(x([...t]),s.target.value="",f.success("上传成功"))};function U(s){const t=ge(s,{isThirtDir:D});k(t.nameList),Z(["文件夹",...t.typeList]),C(t.dirList)}const ae=s=>{const t=[...p];t.splice(s,1),I(t)},le=s=>{if(!l.length){R([s]);return}const t=[...l],a=l.findIndex(i=>i===s);a>-1?t.splice(a,1):t.push(s),t.sort(),R(t)},M=async()=>{if(y(!0),T&&p.length>w){const s=Math.ceil(p.length/w);try{const t=await X({width:r,isSingle:s===1}),a=await ce(t,s);for(let i=0;i<a.length;i++)await O(a[i],"详情.png");f.success("下载完成")}catch{f.error("下载失败!")}finally{y(!1)}}else if(j)O(j,"详情.png"),f("下载成功"),y(!1);else{await q();const s=r+l.join("");O(h[s],"详情.png"),f("下载成功"),y(!1)}},ce=async(s,t)=>new Promise(a=>{const i=new Image;i.src=s;const G=[];i.onload=()=>{const m=P.current;if(!m)return;const g=m.getContext("2d"),{width:re,height:de}=i,F=de/t;for(let Y=0;Y<t;Y++){g==null||g.clearRect(0,0,m.width,m.height),m.width=re,m.height=F,g==null||g.drawImage(i,0,-Y*F);const me=m.toDataURL();G.push(me),G.length===t&&a(G)}}}),V=()=>{E(!0)},q=async()=>{try{const s=r+l.join("");h[s]||X({width:r,isSingle:!0}).then(t=>{S(t),h[s]=t}).catch(t=>{console.log("加载失败 ",t)})}catch{f.error("加载失败")}},oe=()=>{U(o)};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:u.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:ie}),e.jsx("img",{src:Ce,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(b,{className:"preview",disabled:c.length===0||N,onClick:oe,children:"Reset"}),e.jsx(b,{className:"preview",disabled:c.length===0||N,onClick:V,children:"Preview"}),e.jsx(b,{className:"download",disabled:c.length===0||N,primary:!0,onClick:M,children:N?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",c.length]}),e.jsxs("span",{className:"typeNum",title:d.join(","),children:["文件种类：",d.length-1]})]}),e.jsx("div",{className:"options",children:d.map(s=>e.jsx("span",{className:l.includes(s)?"select":"",onClick:()=>le(s),children:s}))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:L,onChange:s=>se(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:B,onChange:s=>te(s.target.value)})]})]}),e.jsx(H.ul,{layout:!0,layoutId:"list",className:"list-container",id:"list",children:e.jsxs(xe,{children:[L&&e.jsx("p",{className:"imgTitle",children:L}),$.map((s,t)=>e.jsxs("div",{className:"",id:"list-"+t,children:[B&&e.jsx("p",{className:"watermark",children:B}),s.map((a,i)=>e.jsxs(H.li,{initial:{y:-200,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0},className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{src:a.image,alt:""}),a.name]}),e.jsx("div",{className:"delIcon",onClick:()=>ae(i)})]},a.name))]},t))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(z,{checked:T,onChange:Q,label:"分割图片"}),e.jsx(z,{checked:D,onChange:ne,label:"只针对二级目录"}),e.jsx(K,{value:r,onSelect:_,OPTIONS:W,label:"图片宽度： "})]})]}),e.jsx("canvas",{ref:P,style:{display:"none"}})]}),e.jsx(Ie,{open:A,setOpen:E,src:j,footer:e.jsx(b,{primary:!0,onClick:()=>{M()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(z,{checked:T,onChange:Q,label:"分割图片"}),e.jsx(K,{value:r,onSelect:_,OPTIONS:W}),e.jsxs("div",{className:u.size,children:["大小: ",j&&fe(ue(j))]})]})})]})}export{ze as default};
