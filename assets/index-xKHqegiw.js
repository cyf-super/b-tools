import{j as e,r as n,A as w}from"./index-7B8ZDjHW.js";import{g as we,B as L,a as Ne,d as Q}from"./index-8K3J76TJ.js";import{C as N}from"./utils-WBCur6ru.js";import{S as ee}from"./index-KQrHoMr8.js";import{a as Se,b as be,g as se}from"./utils-qKFdPO7w.js";import{f as Ie}from"./utils-QMY9RplF.js";import{m as te,A as ye}from"./index-MSlPI7GL.js";const ke="index-module_box_699e6",Ce="index-module_select_7801d",Ae="index-module_modal_cfaa5",Be="index-module_content_6fba2",Le="index-module_icon_6ef84",Te="index-module_left_8b4b3",_e="index-module_loading_831c4",Ee="index-module_spinner-c7wet2_3a953",De="index-module_size_60a86",Ge="index-module_fileItem_12df2",Ye="index-module_name_35fe9",Oe="index-module_fileInfo_50633",Ue="index-module_timer_bfd14",o={box:ke,select:Ce,modal:Ae,content:Be,icon:Le,left:Te,loading:_e,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:Ee,size:De,fileItem:Ge,name:Ye,fileInfo:Oe,timer:Ue},Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function Qe({open:a,src:r,setOpen:i,footer:p,children:h}){const l=S=>{S.stopPropagation(),i(!1)};return e.jsx("div",{className:o.modal,onClick:l,style:a?{}:{display:"none"},children:e.jsxs("main",{className:o.content,onClick:S=>{S.stopPropagation()},children:[e.jsx("span",{className:o.icon,onClick:()=>i(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:o.left,children:r?e.jsx("img",{src:r,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:o.loading})}),h]}),p]})})}const ze=[325,375,425,450,475,525,575,625,675,725,750,775],ne=ze.map(a=>({value:a,label:`宽度: ${a}px`})),ae=25;let u={};function We(){const{files:a,setFiles:r}=we(),[i,p]=n.useState([]),[h,l]=n.useState([]),[S,ce]=n.useState([]),[T,oe]=n.useState(["文件夹"]),[c,_]=n.useState(["mp4","文件夹"]),[b,E]=n.useState([]),[y,k]=n.useState(!1),[j,I]=n.useState(""),[D,z]=n.useState(""),[f,J]=n.useState({name:"长安不止三万里",num:10}),[C,G]=n.useState(!1),[m,P]=n.useState(450),[Y,F]=n.useState(!0),[O,re]=n.useState(!1),[V,de]=n.useState(!0),[A,me]=n.useState(!0),[B,ue]=n.useState(!0),M=n.useRef(!1),q=n.useRef(null);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!i.length)return;M.current?G(!1):X()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=m+c.join("");u[s]?I(u[s]):(I(""),C&&H()),M.current=C},[m,C]),n.useEffect(()=>{a.length&&K(a)},[a,O]),n.useEffect(()=>{const s=m+c.join("");u[s]&&I(u[s])},[b]),n.useEffect(()=>{if(c.length){let s=i.filter(t=>c.includes(t.suffix));c.includes("文件夹")&&(s=[...h,...s]),s.sort(),E(s)}else E(i);I("")},[i,h,c]);const he=s=>{const t=s.target.files;r([]),t&&(console.log("files ",[...t]),r([...t]),s.target.value="",w.success("上传成功"),Z())};function K(s){const t=Se(s,{isThirtDir:O});p(t.nameList),oe(["文件夹",...t.typeList]),l(t.dirList),z(t.dirName),_(["文件夹",...t.typeList]),ce(be(s))}const fe=s=>{const t=[...b];t.splice(s,1),E(t)},xe=s=>{if(!c.length){_([s]);return}const t=[...c],x=c.findIndex(d=>d===s);x>-1?t.splice(x,1):t.push(s),t.sort(),_(t)},W=async()=>{if(k(!0),Y&&b.length>ae){const s=Math.ceil(b.length/ae);try{const t=await se({width:m,isSingle:s===1}),x=await ge(t,s);for(let d=0;d<x.length;d++)await Q(x[d],"详情.jpg");w.success("下载完成")}catch{w.error("下载失败!")}finally{k(!1)}}else if(j)console.log("dataUrl ",j),Q(j,"详情.png"),w("下载成功"),k(!1);else{const s=await H();Q(s,"详情.png"),w("下载成功"),k(!1)}},ge=async(s,t)=>new Promise(x=>{const d=new Image;d.src=s;const U=[];d.onload=()=>{const g=q.current;if(!g)return;const v=g.getContext("2d"),{width:pe,height:je}=d,$=je/t;for(let R=0;R<t;R++){v==null||v.clearRect(0,0,g.width,g.height),g.width=pe,g.height=$,v==null||v.drawImage(d,0,-R*$);const ve=g.toDataURL();U.push(ve),U.length===t&&x(U)}}}),X=()=>{G(!0)},H=async()=>{try{const s=m+c.join("");if(u[s])return u[s];const t=await se({width:m,isSingle:!0});return I(t),u[s]=t,t}catch{w.error("加载失败")}},Z=()=>{K(a),u={}};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:o.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:he}),e.jsx("img",{src:Re,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",style:{width:m+"px"},children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(L,{className:"preview",disabled:i.length===0||y,onClick:Z,children:"Reset"}),e.jsx(L,{className:"preview",disabled:i.length===0||y,onClick:X,children:"Preview"}),e.jsx(L,{className:"download",disabled:i.length===0||y,primary:!0,onClick:W,children:y?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",i.length]}),e.jsxs("span",{className:"typeNum",title:T.join(","),children:["文件种类：",T.length-1]})]}),e.jsx("div",{className:"options",children:T.map(s=>e.jsx("span",{className:c.includes(s)?"select":"",onClick:()=>xe(s),children:s},s))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:D,onChange:s=>z(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:f.name,onChange:s=>J({...f,name:s.target.value})}),e.jsx("input",{type:"text",placeholder:"数量",value:f.num,onChange:s=>J({...f,num:+s.target.value})})]})]}),e.jsx(te.div,{className:"list-container",id:"list",children:e.jsxs(ye,{children:[f.name&&e.jsx("div",{className:"watermarkList",children:Array.from({length:+f.num}).map((s,t)=>e.jsx("p",{className:"watermark",children:f.name||"长安不止三万里"},t))}),D&&e.jsx("p",{className:"imgTitle",children:D}),V?e.jsx(ie,{treeDirList:S,typeList:c,showSize:A,showTimer:B}):b.map((s,t)=>e.jsxs(te.li,{className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{style:{height:A||B?"26px":"16px"},src:s.image,alt:""}),e.jsx(le,{item:s,showSize:A,showTime:B})]}),e.jsx("div",{className:"delIcon",onClick:()=>fe(t)})]},s.name))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(N,{checked:V,onChange:de,label:"文件夹层级格式"}),e.jsx(N,{checked:Y,onChange:F,label:"分割图片"}),e.jsx(N,{checked:O,onChange:re,label:"只针对二级目录"}),e.jsx(N,{checked:A,onChange:me,label:"展示大小"}),e.jsx(N,{checked:B,onChange:ue,label:"展示时间"}),e.jsx(ee,{value:m,onSelect:P,OPTIONS:ne,label:"图片宽度： "})]})]}),e.jsx("canvas",{ref:q,style:{display:"none"}})]}),e.jsx(Qe,{open:C,setOpen:G,src:j,footer:e.jsx(L,{primary:!0,onClick:()=>{W()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(N,{checked:Y,onChange:F,label:"分割图片"}),e.jsx(ee,{value:m,onSelect:P,OPTIONS:ne}),e.jsxs("div",{className:o.size,children:["大小: ",j&&Ie(Ne(j))]})]})})]})}function ie({treeDirList:a,typeList:r,showTimer:i,showSize:p,index:h=0}){return e.jsx("div",{className:"treeDirBox",style:{marginLeft:h*10+"px"},children:a==null?void 0:a.filter(l=>!!l&&(l.dir||r.includes(l.suffix))).map(l=>e.jsxs("div",{className:"item dirItem",children:[e.jsxs("div",{className:["fileName",l.dir?"dirIcon":""].join(" "),children:[e.jsx("img",{src:l.image,alt:""}),e.jsx(le,{item:l,showSize:p,showTime:i})]}),e.jsx(ie,{treeDirList:l.list,typeList:r,index:h+1,showSize:p,showTimer:i})]},l.name||l.dir))})}function le({item:a,showSize:r,showTime:i}){return e.jsxs("div",{className:o.fileItem,children:[e.jsx("div",{className:o.name,children:a.name||a.dir}),(r||i)&&e.jsxs("div",{className:o.fileInfo,children:[i&&e.jsx("span",{className:o.timer,children:a.timer}),r&&e.jsx("span",{className:o.size,children:a.size})]})]})}export{We as default};
