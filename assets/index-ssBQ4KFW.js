import{j as e,r as n,A as g}from"./index-a_A2CTlT.js";import{g as ne,B as y,a as ie,d as T}from"./index-GERrQxdy.js";import{m as R,A as ae,C as G}from"./index-pdg1baTz.js";import{S as V}from"./index-eNyv8oTl.js";import{g as P,a as le,b as U}from"./utils-BBrGjRTu.js";import{f as ce}from"./utils-QMY9RplF.js";import"./utils-q13JPQTf.js";const oe="index-module_box_699e6",re="index-module_select_7801d",de="index-module_modal_cfaa5",me="index-module_content_6fba2",pe="index-module_icon_6ef84",ue="index-module_left_8b4b3",he="index-module_loading_831c4",xe="index-module_spinner-c7wet2_3a953",fe="index-module_size_60a86",m={box:oe,select:re,modal:de,content:me,icon:pe,left:ue,loading:he,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:xe,size:fe},ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function je({open:c,src:h,setOpen:l,footer:A,children:S}){const b=d=>{d.stopPropagation(),l(!1)};return e.jsx("div",{className:m.modal,onClick:b,style:c?{}:{display:"none"},children:e.jsxs("main",{className:m.content,onClick:d=>{d.stopPropagation()},children:[e.jsx("span",{className:m.icon,onClick:()=>l(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:m.left,children:h?e.jsx("img",{src:h,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:m.loading})}),S]}),A]})})}const Se=[325,375,425,450,475,525,575,625,675],q=Se.map(c=>({value:c,label:`宽度: ${c}px`})),j=25,r={};function Ce(){const{files:c,setFiles:h}=ne(),[l,A]=n.useState([]),[S,b]=n.useState([]),[d,F]=n.useState(["文件夹"]),[a,Y]=n.useState(["mp4","文件夹"]),[p,k]=n.useState([]),[K,X]=n.useState([]),[N,v]=n.useState(!1),[x,f]=n.useState(""),[C,W]=n.useState(""),[I,Z]=n.useState(""),[w,B]=n.useState(!1),[o,z]=n.useState(450),[L,D]=n.useState(!0),[E,H]=n.useState(!1),O=n.useRef(!1);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!l.length)return;O.current?B(!1):J()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=o+a.join("");r[s]?f(r[s]):(f(""),w&&M()),O.current=w},[o,w]),n.useEffect(()=>{c.length&&_(c)},[c,E]),n.useEffect(()=>{const t=P(Math.ceil(p.length/j)).map(u=>p.slice(u*j,(u+1)*j));X(t);const i=o+a.join("");r[i]&&f(r[i])},[p]),n.useEffect(()=>{if(a.length){let s=l.filter(t=>a.includes(t.suffix));a.includes("文件夹")&&(s=[...S,...s]),s.sort(),k(s)}else k(l);f("")},[l,S,a]);const $=s=>{const t=s.target.files;h([]),t&&(h([...t]),s.target.value="",g.success("上传成功"))};function _(s){const t=le(s,{isThirtDir:E});A(t.nameList),F(["文件夹",...t.typeList]),b(t.dirList)}const ee=s=>{const t=[...p];t.splice(s,1),k(t)},se=s=>{if(!a.length){Y([s]);return}const t=[...a],i=a.findIndex(u=>u===s);i>-1?t.splice(i,1):t.push(s),t.sort(),Y(t)},Q=async()=>{if(v(!0),L&&p.length>j){const s=P(Math.ceil(p.length/j));s.forEach(async t=>{U({width:o,nodeId:"list-"+t,isSingle:s.length===1}).then(i=>{T(i,"详情.png")}).catch(i=>{console.log("e==> ",i),g.error("生成失败!")}).finally(()=>{v(!1)})})}else if(x)T(x,"详情.png"),g("下载成功"),v(!1);else{await M();const s=o+a.join("");T(r[s],"详情.png"),g("下载成功"),v(!1)}},J=()=>{B(!0)},M=async()=>{try{const s=o+a.join("");console.log(r,r[s]),r[s]||U({width:o,isSingle:!0}).then(t=>{f(t),r[s]=t}).catch(t=>{console.log("加载失败 ",t)})}catch{g.error("加载失败")}},te=()=>{_(c)};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:m.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:$}),e.jsx("img",{src:ge,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(y,{className:"preview",disabled:l.length===0||N,onClick:te,children:"Reset"}),e.jsx(y,{className:"preview",disabled:l.length===0||N,onClick:J,children:"Preview"}),e.jsx(y,{className:"download",disabled:l.length===0||N,primary:!0,onClick:Q,children:N?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",l.length]}),e.jsxs("span",{className:"typeNum",title:d.join(","),children:["文件种类：",d.length-1]})]}),e.jsx("div",{className:"options",children:d.map(s=>e.jsx("span",{className:a.includes(s)?"select":"",onClick:()=>se(s),children:s}))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:C,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:I,onChange:s=>Z(s.target.value)})]})]}),e.jsx(R.ul,{layout:!0,layoutId:"list",className:"list-container",id:"list",children:e.jsxs(ae,{children:[C&&e.jsx("p",{className:"imgTitle",children:C}),K.map((s,t)=>e.jsxs("div",{className:"",id:"list-"+t,children:[I&&e.jsx("p",{className:"watermark",children:I}),s.map((i,u)=>e.jsxs(R.li,{initial:{y:-200,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0},className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{src:i.image,alt:""}),i.name]}),e.jsx("div",{className:"delIcon",onClick:()=>ee(u)})]},i.name))]},t))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(G,{checked:L,onChange:D,label:"分割图片"}),e.jsx(G,{checked:E,onChange:H,label:"只针对二级目录"}),e.jsx(V,{value:o,onSelect:z,OPTIONS:q,label:"图片宽度： "})]})]})]}),e.jsx(je,{open:w,setOpen:B,src:x,footer:e.jsx(y,{primary:!0,onClick:()=>{Q()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(G,{checked:L,onChange:D,label:"分割图片"}),e.jsx(V,{value:o,onSelect:z,OPTIONS:q}),e.jsxs("div",{className:m.size,children:["大小: ",x&&ce(ie(x))]})]})})]})}export{Ce as default};
