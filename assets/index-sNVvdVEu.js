import{j as e,r as n,A as f}from"./index-xfAuskGC.js";import{g as de,B as A,a as me,d as Y}from"./index-QFeQNtLo.js";import{C as O}from"./utils-6FUpLZFw.js";import{S as X}from"./index-WWuq9HPL.js";import{a as ue,g as H}from"./utils-TLZLLtBl.js";import{f as he}from"./utils-QMY9RplF.js";import{m as Z,A as pe}from"./index-UAQNTePt.js";const ge="index-module_box_699e6",fe="index-module_select_7801d",xe="index-module_modal_cfaa5",je="index-module_content_6fba2",we="index-module_icon_6ef84",ve="index-module_left_8b4b3",Ne="index-module_loading_831c4",Se="index-module_spinner-c7wet2_3a953",ye="index-module_size_60a86",p={box:ge,select:fe,modal:xe,content:je,icon:we,left:ve,loading:Ne,"spinner-c7wet2":"index-module_spinner-c7wet2_3a953",spinnerC7Wet2:Se,size:ye},ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC00lEQVR4nO2VMVLbQBSG/zVJQZqYBjKTIvIJgBvoBpgTxJwgogLSoDQBKswJECfAOQG+Ab4BSpGZQBNoYhIGv3wr8ASQ8EiOZ0jBN6PZ1Wr3vf+93X1yemKeBYwtIIitfvlLSzZQy6QFhuo85xjs0Xamp3WQxu6c/kiYX5036xaaaR/HgZwOGEprUldSYIYYpybt65rT6vdtl2gEjqcSOG8NcM7CL84pwkGqB/js/LxUJNOmnD6dbbtYj4Cd8rz9aAtX1zpm0d7pjosYGslQrGpaPttyHYZyYKuY2XXbdJbtb6AbErHXTvqK8yb9UmAnlunDq2k1is4E9vLMrdkRjhddTTEiegwFvMdmese+NorS/hiB346+Um/rdMu1GbpHTsBt2to4WrjryBu6+q3g22fX47USZCEhkHpR5nICiL5DkzI5op0ICIgR8B6bDV7v4XgyfIT9vjZJdUS6VovSNS5kNSSrR2Q1t32ZACYETDjkWs0wEDMp0QTBfoj9I7reYYqfFXx0BbxnaT8x6YKTGqYFJ3VSeCFmivC1RDa8iMQx2EJdG+dBWtE5wndpxN6u0pRmbsMiSvguIhpubt264qphJOJbaWbXbJ+mpRuSsx23Qlsa79f8dhDFCZVqr8qhu3W+7Hz957qS1jrvh1VEDG+Gw1gPI51R9fouCG4bkb+cUng1UNNJ4YuaIkp0l35SNpOzG9bUgIOPwY45nSOgpRL4MzNVU88XpCwKBJxuu9D/J64HWfFKVAK/VkYAQyVEtOiN8q003shQgCpwW3OOCfyA9aTVHwj+34hYqSJiHAHeOf8Gf3uW/c1jvbLB/qU6iJhnIKESdhjOMeV0cVdgkYBsKwiGbo6BKeTgtThDMwQbelus/4vfXyZFdOd5CkH1zLBePBTgAyG6H3Qf40Ic+NpNtU0FrB+fhwLGgfXj8yzgvxAgKShbxIr4JwGT4FnAkwv4A4hoYhuMkolmAAAAAElFTkSuQmCC";function Ae({open:c,src:x,setOpen:i,footer:b,children:N}){const C=d=>{d.stopPropagation(),i(!1)};return e.jsx("div",{className:p.modal,onClick:C,style:c?{}:{display:"none"},children:e.jsxs("main",{className:p.content,onClick:d=>{d.stopPropagation()},children:[e.jsx("span",{className:p.icon,onClick:()=>i(!1)}),e.jsx("header",{children:"图片预览"}),e.jsxs("section",{children:[e.jsx("div",{className:p.left,children:x?e.jsx("img",{src:x,style:{alignSelf:"flex-start"},alt:""}):e.jsx("div",{className:p.loading})}),N]}),b]})})}const be=[325,375,425,450,475,525,575,625,675],$=be.map(c=>({value:c,label:`宽度: ${c}px`})),ee=25;let r={};function Ge(){const{files:c,setFiles:x}=de(),[i,b]=n.useState([]),[N,C]=n.useState([]),[d,se]=n.useState(["文件夹"]),[a,_]=n.useState(["mp4","文件夹"]),[j,I]=n.useState([]),[S,y]=n.useState(!1),[w,v]=n.useState(""),[B,R]=n.useState(""),[m,Q]=n.useState({name:"",num:2}),[k,L]=n.useState(!1),[l,J]=n.useState(450),[E,P]=n.useState(!0),[T,te]=n.useState(!1),U=n.useRef(!1),z=n.useRef(null);n.useEffect(()=>{const s=t=>{if(t.key==="Escape"){if(!i.length)return;U.current?L(!1):q()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),n.useEffect(()=>{const s=l+a.join("");r[s]?v(r[s]):(v(""),k&&F()),U.current=k},[l,k]),n.useEffect(()=>{c.length&&V(c)},[c,T]),n.useEffect(()=>{const s=l+a.join("");r[s]&&v(r[s])},[j]),n.useEffect(()=>{if(a.length){let s=i.filter(t=>a.includes(t.suffix));a.includes("文件夹")&&(s=[...N,...s]),s.sort(),I(s)}else I(i);v("")},[i,N,a]);const ne=s=>{const t=s.target.files;x([]),t&&(x([...t]),s.target.value="",f.success("上传成功"),K())};function V(s){const t=ue(s,{isThirtDir:T});b(t.nameList),se(["文件夹",...t.typeList]),C(t.dirList),R(t.dirName)}const ae=s=>{const t=[...j];t.splice(s,1),I(t)},ie=s=>{if(!a.length){_([s]);return}const t=[...a],u=a.findIndex(o=>o===s);u>-1?t.splice(u,1):t.push(s),t.sort(),_(t)},M=async()=>{if(y(!0),E&&j.length>ee){const s=Math.ceil(j.length/ee);try{const t=await H({width:l,isSingle:s===1}),u=await le(t,s);for(let o=0;o<u.length;o++)await Y(u[o],"详情.jpg");f.success("下载完成")}catch{f.error("下载失败!")}finally{y(!1)}}else if(w)Y(w,"详情.png"),f("下载成功"),y(!1);else{await F();const s=l+a.join("");Y(r[s],"详情.png"),f("下载成功"),y(!1)}},le=async(s,t)=>new Promise(u=>{const o=new Image;o.src=s;const D=[];o.onload=()=>{const h=z.current;if(!h)return;const g=h.getContext("2d"),{width:oe,height:ce}=o,W=ce/t;for(let G=0;G<t;G++){g==null||g.clearRect(0,0,h.width,h.height),h.width=oe,h.height=W,g==null||g.drawImage(o,0,-G*W);const re=h.toDataURL();D.push(re),D.length===t&&u(D)}}}),q=()=>{L(!0)},F=async()=>{try{const s=l+a.join("");r[s]||H({width:l,isSingle:!0}).then(t=>{v(t),r[s]=t}).catch(t=>{console.log("加载失败 ",t)})}catch{f.error("加载失败")}},K=()=>{V(c),r={}};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:p.box,children:[e.jsx("h2",{children:"Generate Picture"}),e.jsxs("div",{className:"upload",children:[e.jsx("input",{type:"file",className:"file",webkitdirectory:"",onChange:ne}),e.jsx("img",{src:ke,alt:""}),e.jsx("div",{className:"text",children:"将文件夹拖到此处，或点击上传"})]}),e.jsxs("section",{className:"content",children:[e.jsxs("section",{className:"left",style:{width:l+"px"},children:[e.jsxs("div",{className:"handleBtn",children:[e.jsx(A,{className:"preview",disabled:i.length===0||S,onClick:K,children:"Reset"}),e.jsx(A,{className:"preview",disabled:i.length===0||S,onClick:q,children:"Preview"}),e.jsx(A,{className:"download",disabled:i.length===0||S,primary:!0,onClick:M,children:S?"Downloading...":"Download"})]}),e.jsxs("div",{className:"fileDetail",children:[e.jsxs("span",{className:"fileNum",children:["文件数量：",i.length]}),e.jsxs("span",{className:"typeNum",title:d.join(","),children:["文件种类：",d.length-1]})]}),e.jsx("div",{className:"options",children:d.map(s=>e.jsx("span",{className:a.includes(s)?"select":"",onClick:()=>ie(s),children:s}))}),e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"titleInput",children:["title：",e.jsx("input",{type:"text",placeholder:"标题",value:B,onChange:s=>R(s.target.value)})]}),e.jsxs("div",{className:"watermarkInput",children:["watermark：",e.jsx("input",{type:"text",placeholder:"水印",value:m.name,onChange:s=>Q({...m,name:s.target.value})}),e.jsx("input",{type:"text",placeholder:"数量",value:m.num,onChange:s=>Q({...m,num:+s.target.value})})]})]}),e.jsx(Z.div,{layout:!0,layoutId:"list",className:"list-container",id:"list",children:e.jsxs(pe,{children:[m.name&&e.jsx("div",{className:"watermarkList",children:Array.from({length:+m.num}).map(s=>e.jsx("p",{className:"watermark",children:m.name||"长安不止三万里"}))}),B&&e.jsx("p",{className:"imgTitle",children:B}),j.map((s,t)=>e.jsxs(Z.li,{initial:{y:-200,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0},className:"item",children:[e.jsxs("div",{className:"fileName",children:[e.jsx("img",{src:s.image,alt:""}),s.name]}),e.jsx("div",{className:"delIcon",onClick:()=>ae(t)})]},s.name))]})})]}),e.jsxs("section",{className:"right",children:[e.jsx(O,{checked:E,onChange:P,label:"分割图片"}),e.jsx(O,{checked:T,onChange:te,label:"只针对二级目录"}),e.jsx(X,{value:l,onSelect:J,OPTIONS:$,label:"图片宽度： "})]})]}),e.jsx("canvas",{ref:z,style:{display:"none"}})]}),e.jsx(Ae,{open:k,setOpen:L,src:w,footer:e.jsx(A,{primary:!0,onClick:()=>{M()},children:"download"}),children:e.jsxs("div",{children:[e.jsx(O,{checked:E,onChange:P,label:"分割图片"}),e.jsx(X,{value:l,onSelect:J,OPTIONS:$}),e.jsxs("div",{className:p.size,children:["大小: ",w&&he(me(w))]})]})})]})}export{Ge as default};
